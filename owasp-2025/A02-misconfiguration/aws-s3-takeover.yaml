id: K70n0s510-s3-takeover
info:
  name: AWS S3 Bucket Takeover & Enumeration (Smart)
  author: K70n0s510
  severity: critical
  description: Detects S3 buckets while ignoring WAFs like Akamai.
http:
  - method: GET
    path:
      - "{{BaseURL}}"
      - "https://s3.amazonaws.com/{{HostName}}"
      - "https://{{HostName}}.s3.amazonaws.com"

    matchers-condition: or
    matchers:
      # Match 1: Open Listing (XML)
      - type: word
        name: s3-open-listing
        words:
          - "<ListBucketResult"
          - "<Name>{{HostName}}</Name>"
          - "<Key>"

      # Match 2: Permission Error (BUT MUST BE S3)
      - type: dsl
        name: s3-permission-error
        dsl:
          - "contains(body, 'Access Denied') && contains(header, 'AmazonS3')"
          - "contains(body, 'Access Denied') && contains(header, 'x-amz-request-id')"

      # Match 3: Leaky Links
      - type: word
        name: leaky-s3-links
        words:
          - "s3.amazonaws.com"
        part: body
