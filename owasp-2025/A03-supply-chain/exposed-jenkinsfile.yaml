id: K70n0s510-smart-jenkins
info:
  name: Jenkins Takeover (Flow Logic)
  author: K70n0s510
  severity: critical
  description: Identifies Jenkins and immediately attempts to find the Script Console and Secrets.
flow: |
  http(1) && (http(2) || http(3))

http:
  # Step 1: Detect Jenkins Fingerprint
  - method: GET
    path:
      - "{{BaseURL}}/login"
    matchers:
      - type: word
        words:
          - "X-Jenkins"
          - "Jenkins"
        part: header
        internal: true

  # Step 2: If Step 1 hits, try to access Script Console (RCE)
  - method: GET
    path:
      - "{{BaseURL}}/script"
    matchers:
      - type: word
        words:
          - "println(Jenkins.instance.pluginManager.plugins)"
          - "Groovy script"

  # Step 3: Or try to read credentials.xml
  - method: GET
    path:
      - "{{BaseURL}}/credentials.xml"
      - "{{BaseURL}}/jobs/credentials.xml"
    matchers:
      - type: word
        words:
          - "<com.cloudbees.plugins.credentials.SystemCredentialsProvider"
